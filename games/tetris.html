<!doctype html>
<html lang="de"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Tetris</title><link rel="stylesheet" href="../assets/styles.css"/></head>
<body><main class="page"><div class="container" style="align-items:stretch;max-width:820px;">
<h1 class="name"><span class="gradient-text">Tetris</span></h1>
<section class="card"><canvas id="c" width="480" height="260" class="vgame" style="width:100%;height:260px;display:block"></canvas><div class="muted">Arrows/WASD (W rotate)</div></section>
<footer class="footer"><p>Â© <span id="y"></span> Maro</p></footer></div></main>
<script type="module">
import { unlockAchievement } from '../components/achievements.js'; unlockAchievement('tetris_stack');
document.getElementById('y').textContent = new Date().getFullYear();
const canvas=document.getElementById('c'); const ctx=canvas.getContext('2d'); let W=canvas.width,H=canvas.height; const COLS=10, ROWS=18, S=24; let grid=Array.from({length:ROWS},()=>Array(COLS).fill(0));
const shapes=[[[1,1,1,1]], [[1,1],[1,1]], [[0,1,0],[1,1,1]], [[1,0,0],[1,1,1]], [[0,0,1],[1,1,1]]];
let p=newPiece(), x=3,y=0,tick=0,run=true,score=0;
function newPiece(){ return shapes[Math.floor(Math.random()*shapes.length)]; }
function collide(px,py,pp){ for(let r=0;r<pp.length;r++) for(let c=0;c<pp[0].length;c++) if(pp[r][c]&& (py+r>=ROWS||px+c<0||px+c>=COLS||grid[py+r][px+c])) return true; return false; }
function merge(px,py,pp){ for(let r=0;r<pp.length;r++) for(let c=0;c<pp[0].length;c++) if(pp[r][c]) grid[py+r][px+c]=1; }
function rot(pp){ return pp[0].map((_,i)=>pp.map(r=>r[i]).reverse()); }
function clearLines(){ for(let r=ROWS-1;r>=0;r--){ if(grid[r].every(v=>v)){ grid.splice(r,1); grid.unshift(Array(COLS).fill(0)); score+=100; r++; } } }
function draw(){ ctx.clearRect(0,0,W,H); ctx.fillStyle='rgba(0,0,0,.2)'; ctx.fillRect(0,0,W,H); for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){ if(grid[r][c]){ ctx.fillStyle='#00ffc8'; ctx.fillRect(c*S,r*S,S-2,S-2);} } ctx.fillStyle='#aee7df'; for(let r=0;r<p.length;r++) for(let c=0;c<p[0].length;c++) if(p[r][c]) ctx.fillRect((x+c)*S,(y+r)*S,S-2,S-2); ctx.fillText('Score '+score,6,14); }
function step(){ if(!run) return; if(++tick%20===0){ if(!collide(x,y+1,p)){ y++; } else { merge(x,y,p); clearLines(); p=newPiece(); x=3; y=0; if(collide(x,y,p)){ run=false; } } draw(); } requestAnimationFrame(step); }
let timer;
function onKey(e){ if(!run) return; const k=e.key; if((k==='ArrowLeft'||k==='a'||k==='A') && !collide(x-1,y,p)) x--; else if((k==='ArrowRight'||k==='d'||k==='D') && !collide(x+1,y,p)) x++; else if(k==='ArrowUp'||k==='w'||k==='W'){ const np=rot(p); if(!collide(x,y,np)) p=np; } else if(k==='ArrowDown'||k==='s'||k==='S'){ if(!collide(x,y+1,p)) y++; } draw(); }
function start(){ timer=setInterval(step,16); window.addEventListener('keydown', onKey); }
window.addEventListener('terminal:interrupt', ()=>{ clearInterval(timer); window.removeEventListener('keydown', onKey); run=false; });
const fs=document.createElement('div'); fs.style.cssText='position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:1005;color:#e5eef8;font:14px ui-monospace;'; fs.innerHTML='<div class="card" style="padding:12px 16px">Click to enter fullscreen and play</div>'; document.body.appendChild(fs); fs.addEventListener('click', async ()=>{ try{ await document.documentElement.requestFullscreen?.(); }catch(_){} fs.remove(); start(); });
 </script>
 <script type="module" src="../assets/version.js"></script>
 </body></html>
