let y,R,I,b,k=[],D=null,H=null,G=null,B=new Set(JSON.parse(localStorage.getItem("maro_achievements")||"[]"));function d(t,n,l){const e=document.createElement(t);return n&&(e.className=n),l!=null&&(e.textContent=l),e}function M(t,n="btn"){return d("button",n,t)}function U(t){if(!y?.classList.contains("active")||!(t.key==="Tab")||k.length===0)return;const l=k[0],e=k[k.length-1];t.shiftKey&&document.activeElement===l?(t.preventDefault(),e.focus()):!t.shiftKey&&document.activeElement===e&&(t.preventDefault(),l.focus())}function T(t){B.add(t),localStorage.setItem("maro_achievements",JSON.stringify(Array.from(B)))}function K(t,n){G&&document.documentElement.classList.remove("theme-"+G),G=t,t&&document.documentElement.classList.add("theme-"+t),n&&localStorage.setItem("maro_theme",t||"")}function J(){const t=localStorage.getItem("maro_theme");t&&K(t,!1)}function V(){const t=d("div");return[`   __  __            _         
  |  \\/  | __ _ _ __| |__  ___ 
  | |\\/| |/ _\` | '__| '_ \\/ __|
  | |  | | (_| | |  | | | \\__ \\
  |_|  |_|\\__,_|_|  |_| |_|___/
`,`             /\\                 
   __       /::\\    __          
  /\\_\\    /::::\\  /\\_\\  ____  
 / / /   /:/\\:::\\ \\:\\/ / / __ \\
/_/ /   /:/  \\:::\\ \\::/ /_/ /_/ /
\\_\\   \\_\\   \\:::/  \\_\\ \\____/ 
`,`          
   \\   
    \\_//  Tron Grid
    \\
   \\  \\
`].forEach(l=>{const e=d("pre","ascii-block");e.textContent=l,t.appendChild(e)}),t}function X(t){const n=d("div","grid cols-2");return[{id:"click",make:e=>{const o=e.createOscillator(),i=e.createGain();o.type="square",o.frequency.value=880,i.gain.value=.05,o.connect(i).connect(e.destination),o.start(),o.stop(e.currentTime+.06)}},{id:"glitch",make:e=>{const o=e.createBuffer(1,.06*e.sampleRate,e.sampleRate),i=o.getChannelData(0);for(let s=0;s<i.length;s++)i[s]=(Math.random()*2-1)*(s%23<3?.8:.2);const a=e.createBufferSource();a.buffer=o,a.connect(e.destination),a.start()}},{id:"chime",make:e=>{const o=e.createOscillator(),i=e.createGain();o.type="sine",o.frequency.setValueAtTime(880,e.currentTime),o.frequency.exponentialRampToValueAtTime(440,e.currentTime+.4),i.gain.setValueAtTime(.05,e.currentTime),i.gain.exponentialRampToValueAtTime(1e-4,e.currentTime+.45),o.connect(i).connect(e.destination),o.start(),o.stop(e.currentTime+.5)}},{id:"static",make:e=>{const o=e.createBuffer(1,.2*e.sampleRate,e.sampleRate),i=o.getChannelData(0);for(let m=0;m<i.length;m++)i[m]=Math.random()*2-1;const a=e.createBufferSource();a.buffer=o;const s=e.createGain();s.gain.value=.02,a.connect(s).connect(e.destination),a.start()}}].forEach(e=>{const o=M(e.id);o.addEventListener("click",()=>{t.secret.ENABLE_SFX&&(H=H||new(window.AudioContext||window.webkitAudioContext),e.make(H),T("Played sound: "+e.id))}),n.appendChild(o)}),n}function j(t){const n=d("div"),l=d("div","row"),e=document.createElement("select");e.className="select",["","neon-overdrive","crt-glitch","void"].forEach(i=>{const a=document.createElement("option");a.value=i,a.textContent=i||"default",e.appendChild(a)});const o=M("Apply");return o.addEventListener("click",()=>{const i=!!t.secret.PERSIST_THEMES;K(e.value,i),T("Changed theme")}),l.append(e,o),n.appendChild(l),n.appendChild(d("div","muted","Themes are temporary unless persisted by config.")),n}function z(){const t=d("div"),n=d("ul");return Array.from(B).forEach(l=>{const e=d("li",null,"â€¢ "+l);n.appendChild(e)}),n.childElementCount?t.appendChild(n):t.appendChild(d("div","muted","No achievements yet.")),t}function Q(t){const n=d("div");return t.secret.SHOW_HIDDEN_LINKS?([{label:"Dev Tools",href:"#dev-tools"},{label:"Staging Page",href:"#staging"}].forEach(e=>{const o=document.createElement("a");o.href=e.href,o.textContent=e.label,o.target="_blank",o.rel="noopener",n.appendChild(o),n.appendChild(document.createElement("br"))}),n):(n.appendChild(d("div","muted","Hidden links are disabled.")),n)}function Y(){const t=d("div","grid cols-2"),n=document.createElement("canvas");n.className="vgame",t.appendChild(n),Z(n);const l=document.createElement("canvas");return l.className="vgame",t.appendChild(l),$(l),t}function Z(t){const n=t.getContext("2d");let l=t.width=480,e=t.height=260,o=20,i=Math.floor(l/o),a=Math.floor(e/o),s=[[5,5]],m=[1,0],c=[10,7],h=!0,u=0;function E(){c=[Math.floor(Math.random()*i),Math.floor(Math.random()*a)]}function L(){if(!h)return;const v=[(s[0][0]+m[0]+i)%i,(s[0][1]+m[1]+a)%a];s.some(([S,N])=>S===v[0]&&N===v[1])&&(h=!1,T("Found the Snake")),s.unshift(v),v[0]===c[0]&&v[1]===c[1]?(u++,E()):s.pop(),C()}function C(){n.clearRect(0,0,l,e),n.fillStyle="rgba(0,0,0,.2)",n.fillRect(0,0,l,e),n.fillStyle="#00ffc8",s.forEach(([v,S])=>n.fillRect(v*o,S*o,o-2,o-2)),n.fillStyle="#34d399",n.fillRect(c[0]*o,c[1]*o,o-2,o-2),n.fillStyle="#aee7df",n.fillText("Score "+u,6,14)}let A=setInterval(L,130);function g(v){v.key==="ArrowUp"?m=[0,-1]:v.key==="ArrowDown"?m=[0,1]:v.key==="ArrowLeft"?m=[-1,0]:v.key==="ArrowRight"&&(m=[1,0])}window.addEventListener("keydown",g),t._destroy=()=>{clearInterval(A),window.removeEventListener("keydown",g)}}function $(t){const n=t.getContext("2d");let l=t.width=480,e=t.height=260;const o=10,i=18,a=24;let s=Array.from({length:i},()=>Array(o).fill(0));const m=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]]];let c=A(),h=3,u=0,E=0,L=0,C=!0;function A(){return m[Math.floor(Math.random()*m.length)]}function g(r,f,w){for(let p=0;p<w.length;p++)for(let _=0;_<w[0].length;_++)if(w[p][_]&&(f+p>=i||r+_<0||r+_>=o||s[f+p][r+_]))return!0;return!1}function v(r,f,w){for(let p=0;p<w.length;p++)for(let _=0;_<w[0].length;_++)w[p][_]&&(s[f+p][r+_]=1)}function S(r){return r[0].map((f,w)=>r.map(p=>p[w]).reverse())}function N(){for(let r=i-1;r>=0;r--)s[r].every(f=>f)&&(s.splice(r,1),s.unshift(Array(o).fill(0)),L+=100,r++)}function O(){n.clearRect(0,0,l,e),n.fillStyle="rgba(0,0,0,.2)",n.fillRect(0,0,l,e);for(let r=0;r<i;r++)for(let f=0;f<o;f++)s[r][f]&&(n.fillStyle="#00ffc8",n.fillRect(f*a,r*a,a-2,a-2));n.fillStyle="#aee7df";for(let r=0;r<c.length;r++)for(let f=0;f<c[0].length;f++)c[r][f]&&n.fillRect((h+f)*a,(u+r)*a,a-2,a-2);n.fillStyle="#aee7df",n.fillText("Score "+L,6,14)}function P(){C&&++E%20===0&&(g(h,u+1,c)?(v(h,u,c),N(),c=A(),h=3,u=0,g(h,u,c)&&(C=!1,T("Beat Tetris 1000 pts"))):u++,O())}let W=setInterval(P,16);function q(r){if(C){if(r.key==="ArrowLeft"&&!g(h-1,u,c))h--;else if(r.key==="ArrowRight"&&!g(h+1,u,c))h++;else if(r.key==="ArrowUp"){const f=S(c);g(h,u,f)||(c=f)}else r.key==="ArrowDown"&&(g(h,u+1,c)||u++);O()}}window.addEventListener("keydown",q),t._destroy=()=>{clearInterval(W),window.removeEventListener("keydown",q)}}function F(t){b.innerHTML="",b.appendChild(t)}function x(t){y=d("div","vault-overlay"),R=d("div","vault-panel");const n=d("div","vault-header"),l=d("div","vault-title","Easter Egg Vault"),e=d("div","vault-spacer"),o=M("Close","vault-close");n.append(l,e,o);const i=d("div","vault-body");I=d("div","vault-nav"),b=d("div","vault-content"),i.append(I,b),R.append(n,i),y.append(R),document.body.appendChild(y);function a(c,h){const u=M(c,"vault-tab");return u.addEventListener("click",()=>{[...I.children].forEach(E=>E.classList.remove("active")),u.classList.add("active"),F(h())}),I.appendChild(u),u}const s=a("ASCII-Gallery",V);a("Mini-Games",()=>Y()),a("Secret Themes",()=>j(t)),a("Soundboard",()=>X(t)),a("Achievements",z),a("Hidden Links",()=>Q(t)),s.classList.add("active"),F(V());function m(){y.classList.remove("active"),b.querySelectorAll("canvas.vgame").forEach(c=>c._destroy&&c._destroy()),D&&D.focus()}o.addEventListener("click",m),y.addEventListener("click",c=>{c.target===y&&m()}),window.addEventListener("keydown",c=>{y.classList.contains("active")&&c.key==="Escape"&&m()}),window.addEventListener("keydown",U),k=Array.from(R.querySelectorAll('button, [href], select, textarea, [tabindex]:not([tabindex="-1"])')),D=document.activeElement,k[0]?.focus(),J()}function ee({config:t}){y||x(t),y.classList.add("active"),T("Typed sudo secret")}export{ee as openVault};
